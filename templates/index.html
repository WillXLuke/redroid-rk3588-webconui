<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>Redroid 容器管理面板</title>
  <style>
    *{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:"微软雅黑",Arial,sans-serif;background:#f0f2f5;color:#333;padding:20px;}
    .container{max-width:1000px;margin:0 auto;}
    h1,h2,h3{margin-bottom:10px;}
    .panel{background:#fff;border-radius:6px;box-shadow:0 2px 4px rgba(0,0,0,0.1);padding:20px;margin-bottom:20px;}
    table{width:100%;border-collapse:collapse;margin-top:10px;}
    th,td{text-align:center;padding:10px;border-bottom:1px solid #e0e0e0;}
    th{background:#fafafa;}
    tr:last-child td{border-bottom:none;}
    .actions a{margin:0 5px;color:#007bff;text-decoration:none;}
    .actions a:hover{text-decoration:underline;}
    form label{display:block;margin:10px 0 5px;font-weight:bold;}
    form input{width:100%;padding:8px;border:1px solid #ccc;border-radius:4px;}
    .row{display:flex;gap:20px;}
    .row>div{flex:1;}
    button{margin-top:15px;padding:10px 20px;background:#007bff;color:#fff;border:none;border-radius:4px;cursor:pointer;}
    button:hover{background:#0056b3;}
    #port-msg{color:#d9534f;font-size:0.9em;}
  </style>
</head>
<body>
  <div class="container">
    <h1>Redroid 容器管理面板</h1>
    <div class="panel">
      <h3>本机 IPv4 地址：{{ host_ip }}</h3>
    </div>
    <div class="panel">
      <h2>创建新容器</h2>
      <form action="/create" method="post" onsubmit="return checkPort();">
        <div class="row">
          <div>
            <label>容器名称（不含 redroid- 前缀）</label>
            <input name="name" required placeholder="示例：114514">
          </div>
          <div>
            <label>映射端口（5555–65535）</label>
            <input name="port" id="port" type="number" required min="5555" max="65535" placeholder="示例：5555">
            <span id="port-msg"></span>
          </div>
        </div>
        <div class="row">
          <div>
            <label>分辨率宽度 (px)</label>
            <input name="width" type="number" required min="100" max="5000" value="720">
          </div>
          <div>
            <label>分辨率高度 (px)</label>
            <input name="height" type="number" required min="100" max="5000" value="1280">
          </div>
        </div>
        <h3>SOCKS5 代理配置</h3>
        <div class="row">
          <div>
            <label>代理地址</label>
            <input name="proxy_host" required placeholder="示例：127.0.0.1">
          </div>
          <div>
            <label>代理端口</label>
            <input name="proxy_port" type="number" required placeholder="示例：1080">
          </div>
        </div>
        <div class="row">
          <div>
            <label>代理用户名</label>
            <input name="proxy_user" placeholder="可选">
          </div>
          <div>
            <label>代理密码</label>
            <input name="proxy_pass" type="password" placeholder="可选">
          </div>
        </div>
        <button type="submit">创建容器</button>
      </form>
    </div>
    <div class="panel">
      <h2>当前容器列表</h2>
      <table>
        <thead>
          <tr>
            <th>名称</th>
            <th>状态</th>
            <th>端口</th>
            <th>代理地址:端口</th>
            <th>账号</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody>
          {% for c in containers %}
          <tr>
            <td>{{ c.name }}</td>
            <td>{{ c.status }}</td>
            <td>{{ c.port }}</td>
            <td>{{ c.proxy.host }}:{{ c.proxy.port }}</td>
            <td>{{ c.proxy.user }}</td>
            <td class="actions">
              <a href="/start/{{ c.name }}">启动</a>
              <a href="/stop/{{ c.name }}">停止</a>
              <a href="/restart/{{ c.name }}">重启</a>
              <a href="/delete/{{ c.name }}" onclick="return confirm('确认删除 {{ c.name }}？');">删除</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <script>
    async function checkPort() {
      const port = document.getElementById('port').value;
      const res = await fetch(`/check_port?port=${port}`);
      const data = await res.json();
      const msg = document.getElementById('port-msg');
      if (data.used) {
        msg.textContent = '端口已被占用，请选择其他端口';
        return false;
      }
      msg.textContent = '';
      return true;
    }
  </script>
</body>
</html>
